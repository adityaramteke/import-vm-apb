FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGltcG9ydC12bS1hcGIKZGVzY3JpcHRpb246IEltcG9ydCBWaXJ0\
dWFsIE1hY2hpbmUKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBk\
aXNwbGF5TmFtZTogSW1wb3J0IFZNIChBUEIpCiAgaW1hZ2VVcmw6IGh0dHBzOi8vY2RuLnBicmQu\
Y28vaW1hZ2VzL0g1R3V0ZDcucG5nCnBsYW5zOgogIC0gbmFtZTogdm13YXJlCiAgICBkZXNjcmlw\
dGlvbjogVXNlIHYydiB0byBpbXBvcnQgYSBWaXJ0dWFsIE1hY2hpbmUgZnJvbSBWTVdhcmUgdkNl\
bnRlcgogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBJbXBv\
cnQgZnJvbSBWTVdhcmUKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gdGl0bGU6IE9wZW5zaGlmdCBB\
ZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZW5zaGlmdCBBZG1pbiBQYXNz\
d29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAg\
IC0gdGl0bGU6IFZNd2FyZSB1cmwgdG8gRVhTaQogICAgICAgIG5hbWU6IHVybAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFZpcnR1YWwg\
bWFjaGluZSBuYW1lCiAgICAgICAgbmFtZTogdm1fbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFZNd2FyZSBBZG1pbgogICAgICAg\
IG5hbWU6IHVzZXJuYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRy\
dWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHVzZXJuYW1lCiAgICAgIC0gdGl0bGU6IFZNd2FyZSBB\
ZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IHBhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAg\
LSBuYW1lOiB1cmwKICAgIGRlc2NyaXB0aW9uOiBDcmVhdGUgYSBWaXJ0dWFsIE1hY2hpbmUgZnJv\
bSBhIGRvd25sb2FkZWQgZGlzayBpbWFnZQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAg\
ICAgIGRpc3BsYXlOYW1lOiBJbXBvcnQgZnJvbSBVUkwKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0g\
dGl0bGU6IE9wZW5zaGlmdCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9w\
ZW5zaGlmdCBBZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5\
cGU6IHBhc3N3b3JkCiAgICAgIC0gdGl0bGU6IERpc2sgSW1hZ2UgVVJMCiAgICAgICAgbmFtZTog\
ZGlza19pbWFnZV91cmwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAtIHRpdGxlOiBWaXJ0dWFsIE1hY2hpbmUgVHlwZQogICAgICAgIG5hbWU6IHZtX3R5\
cGUKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydkZWZhdWx0J10KICAgICAgICBy\
ZXF1aXJlZDogVHJ1ZQogICAgICAgIGRlZmF1bHQ6IGRlZmF1bHQKICAgICAgICBkaXNwbGF5X3R5\
cGU6IHNlbGVjdAogICAgICAtIHRpdGxlOiBWaXJ0dWFsIE1hY2hpbmUgTmFtZQogICAgICAgIG5h\
bWU6IHZtX25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAtIHRpdGxlOiBOdW1iZXIgb2YgQ1BVcwogICAgICAgIG5hbWU6IG5yX2NwdXMKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIHR5cGU6IGludAogICAgICAgIGRlZmF1bHQ6IDEKICAg\
ICAgLSB0aXRsZTogTWVtb3J5IChpbiBNZWdhYnl0ZXMpCiAgICAgICAgbmFtZTogbWVtCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICB0eXBlOiBpbnQKICAgICAgICBkZWZhdWx0OiAxMDI0\
Cg=="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
RUN yum -y install libvirt-client curl qemu-img wget && yum clean all
RUN wget https://github.com/kubevirt/v2v-job/releases/download/v0.3.0/run.sh && chmod +x run.sh
USER apb
