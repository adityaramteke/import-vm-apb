FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGltcG9ydC12bS1hcGIKZGVzY3JpcHRpb246IEltcG9ydCBWaXJ0\
dWFsIE1hY2hpbmUKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gdmly\
dHVhbG1hY2hpbmUKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEltcG9ydCBWaXJ0dWFsIE1hY2hp\
bmUKICBpbWFnZVVybDogaHR0cHM6Ly9jZG4ucGJyZC5jby9pbWFnZXMvSDVHdXRkNy5wbmcKICBs\
b25nRGVzY3JpcHRpb246IHwKICAgICBJbXBvcnQgVmlydHVhbCBNYWNoaW5lIGZyb20gYW4gZXhp\
c3RpbmcgaW1hZ2Ugb3IgYSBWTXdhcmUgZW52aXJvbm1lbnQuCnBsYW5zOgogIC0gbmFtZTogdm13\
YXJlCiAgICBkZXNjcmlwdGlvbjogSW1wb3J0IGEgdmlydHVhbCBtYWNoaW5lIGZyb20gVk13YXJl\
IHZDZW50ZXIuCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6\
IGMuIEltcG9ydCBmcm9tIFZNd2FyZS4KICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gdGl0bGU6IE9w\
ZW5TaGlmdCBBZG1pbiBVc2VybmFtZQogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hp\
ZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAtIHRpdGxlOiBWTXdhcmUgVVJMIHRvIEVYU2kKICAgICAgICBuYW1lOiB1\
cmwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRp\
dGxlOiBWaXJ0dWFsIE1hY2hpbmUgTmFtZQogICAgICAgIG5hbWU6IHZtX25hbWUKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIHBhdHRlcm46ICJeW2Et\
ejAtOV8uLV0qJCIKICAgICAgLSB0aXRsZTogVk13YXJlIEFkbWluIFVzZXJuYW1lCiAgICAgICAg\
bmFtZTogdXNlcm5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAgIGRpc3BsYXlfdHlwZTogdXNlcm5hbWUKICAgICAgLSB0aXRsZTogVk13YXJlIEFk\
bWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogcGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAg\
ICAgLSB0aXRsZTogT3BlcmF0aW5nIFN5c3RlbSBUeXBlCiAgICAgICAgbmFtZTogb3NfdHlwZQog\
ICAgICAgIGRlZmF1bHQ6IGxpbnV4CiAgICAgICAgZW51bTogWydsaW51eCcsICd3aW5kb3dzJ10K\
ICAgICAgICB0eXBlOiBlbnVtCiAgLSBuYW1lOiB2bXdhcmUtdGVtcGxhdGUKICAgIGRlc2NyaXB0\
aW9uOiBJbXBvcnQgYSB2aXJ0dWFsIG1hY2hpbmUgYXMgYSB0ZW1wbGF0ZSBmcm9tIFZNd2FyZSB2\
Q2VudGVyLgogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBk\
LiBJbXBvcnQgYXMgYSB0ZW1wbGF0ZSBmcm9tIFZNd2FyZS4KICAgIHBhcmFtZXRlcnM6CiAgICAg\
IC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBVc2VybmFtZQogICAgICAgIG5hbWU6IGFkbWluX3Vz\
ZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRp\
dGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29y\
ZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlz\
cGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIHRpdGxlOiBWTXdhcmUgVVJMIHRvIEVYU2kKICAg\
ICAgICBuYW1lOiB1cmwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAtIHRpdGxlOiBUZW1wbGF0ZSBOYW1lCiAgICAgICAgbmFtZTogdm1fbmFtZQogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgcGF0dGVybjog\
Il5bYS16MC05Xy4tXSokIgogICAgICAtIHRpdGxlOiBWTXdhcmUgQWRtaW4gVXNlcm5hbWUKICAg\
ICAgICBuYW1lOiB1c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiB1c2VybmFtZQogICAgICAtIHRpdGxlOiBWTXdh\
cmUgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBwYXNzd29yZAogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29y\
ZAogICAgICAtIHRpdGxlOiBPcGVyYXRpbmcgU3lzdGVtIFR5cGUKICAgICAgICBuYW1lOiBvc190\
eXBlCiAgICAgICAgZGVmYXVsdDogbGludXgKICAgICAgICBlbnVtOiBbJ2xpbnV4JywgJ3dpbmRv\
d3MnXQogICAgICAgIHR5cGU6IGVudW0KICAtIG5hbWU6IHVybAogICAgZGVzY3JpcHRpb246IENy\
ZWF0ZSBhIHZpcnR1YWwgbWFjaGluZSBmcm9tIGEgZG93bmxvYWRlZCBkaXNrIGltYWdlLgogICAg\
ZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBhLiBJbXBvcnQgZnJv\
bSBVUkwuCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBEaXNrIEltYWdlIFVSTAogICAg\
ICAgIG5hbWU6IGRpc2tfaW1hZ2VfdXJsCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogT3BlcmF0aW5nIHN5c3RlbSB0eXBlCiAgICAgICAg\
bmFtZTogb3NfdHlwZQogICAgICAgIGRlZmF1bHQ6IGxpbnV4CiAgICAgICAgZW51bTogWydsaW51\
eCcsICd3aW5kb3dzJ10KICAgICAgICB0eXBlOiBlbnVtCiAgICAgIC0gdGl0bGU6IFZpcnR1YWwg\
TWFjaGluZSBOYW1lCiAgICAgICAgbmFtZTogdm1fbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgcGF0dGVybjogIl5bYS16MC05Xy4tXSokIgog\
ICAgICAtIHRpdGxlOiBOdW1iZXIgb2YgQ29yZXMKICAgICAgICBuYW1lOiBucl9jb3JlcwogICAg\
ICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgdHlwZTogaW50CiAgICAgICAgZGVmYXVsdDogMQog\
ICAgICAtIHRpdGxlOiBNZW1vcnkgKE1pQikKICAgICAgICBuYW1lOiBtZW0KICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAgIHR5cGU6IGludAogICAgICAgIGRlZmF1bHQ6IDEwMjQKICAgICAg\
LSB0aXRsZTogRGlzayBTaXplIChHaUIpIChsZWF2ZSBhdCAwIHRvIGF1dG8gZGV0ZWN0IHNpemUp\
CiAgICAgICAgbmFtZTogZGlza19zaXplX2diCiAgICAgICAgdHlwZTogaW50CiAgICAgICAgZGVm\
YXVsdDogMAogICAgICAtIHRpdGxlOiBTdG9yYWdlIENsYXNzIChsZWF2ZSBlbXB0eSB0byB1c2Ug\
dGhlIGRlZmF1bHQgc3RvcmFnZSBjbGFzcykKICAgICAgICBuYW1lOiBzdG9yYWdlX2NsYXNzCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgLSBuYW1lOiB1cmwtdGVtcGxhdGUKICAgIGRlc2NyaXB0aW9u\
OiBDcmVhdGUgYSB2aXJ0dWFsIG1hY2hpbmUgdGVtcGxhdGUgZnJvbSBhIGRvd25sb2FkZWQgZGlz\
ayBpbWFnZS4KICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTog\
Yi4gSW1wb3J0IGFzIGEgdGVtcGxhdGUgZnJvbSBVUkwuCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gVXNlcm5hbWUKICAgICAgICBuYW1lOiBhZG1pbl91c2Vy\
CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRs\
ZTogT3BlblNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgbmFtZTogYWRtaW5fcGFzc3dvcmQK\
ICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3Bs\
YXlfdHlwZTogcGFzc3dvcmQKICAgICAgLSB0aXRsZTogRGlzayBJbWFnZSBVUkwKICAgICAgICBu\
YW1lOiBkaXNrX2ltYWdlX3VybAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZXJhdGluZyBzeXN0ZW0gdHlwZQogICAgICAgIG5hbWU6\
IG9zX3R5cGUKICAgICAgICBkZWZhdWx0OiBsaW51eAogICAgICAgIGVudW06IFsnbGludXgnLCAn\
d2luZG93cyddCiAgICAgICAgdHlwZTogZW51bQogICAgICAtIHRpdGxlOiBUZW1wbGF0ZSBOYW1l\
CiAgICAgICAgbmFtZTogdm1fbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgICAgcGF0dGVybjogIl5bYS16MC05Xy4tXSokIgogICAgICAtIHRpdGxl\
OiBOdW1iZXIgb2YgQ29yZXMKICAgICAgICBuYW1lOiBucl9jb3JlcwogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgdHlwZTogaW50CiAgICAgICAgZGVmYXVsdDogMQogICAgICAtIHRpdGxl\
OiBNZW1vcnkgKE1pQikKICAgICAgICBuYW1lOiBtZW0KICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAgIHR5cGU6IGludAogICAgICAgIGRlZmF1bHQ6IDEwMjQKICAgICAgLSB0aXRsZTogRGlz\
ayBTaXplIChHaUIpIChsZWF2ZSBhdCAwIHRvIGF1dG8gZGV0ZWN0IHNpemUpCiAgICAgICAgbmFt\
ZTogZGlza19zaXplX2diCiAgICAgICAgdHlwZTogaW50CiAgICAgICAgZGVmYXVsdDogMAogICAg\
ICAtIHRpdGxlOiBTdG9yYWdlIENsYXNzIChsZWF2ZSBlbXB0eSB0byB1c2UgdGhlIGRlZmF1bHQg\
c3RvcmFnZSBjbGFzcykKICAgICAgICBuYW1lOiBzdG9yYWdlX2NsYXNzCiAgICAgICAgdHlwZTog\
c3RyaW5nCg=="



RUN chmod -R g=u /opt/{ansible,apb}
RUN yum -y install libvirt-client curl qemu-img wget && yum clean all
# We need this to get oc v3.9 due to the issue with oc apply. Once we would update apb-base to use 3.9 we can remove it
RUN wget https://github.com/openshift/origin/releases/download/v3.9.0/openshift-origin-client-tools-v3.9.0-191fece-linux-64bit.tar.gz
RUN tar zxvf openshift-origin-client-tools-v3.9.0-191fece-linux-64bit.tar.gz
RUN mv openshift-origin-client-tools-v3.9.0-191fece-linux-64bit/oc /usr/bin
RUN rm -rf openshift-origin-client-tools-v3.9.0-191fece-linux-64bit
RUN chmod u+x /usr/bin/oc
# future removal ends here
COPY bin/run-v2v.sh /v2v.d/
RUN setfacl -Rm u:apb:rwx /v2v.d

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY templates /opt/ansible/templates

USER apb
