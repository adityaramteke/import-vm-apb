FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGltcG9ydC12bS1hcGIKZGVzY3JpcHRpb246IEltcG9ydCBWaXJ0\
dWFsIE1hY2hpbmUKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gdmly\
dHVhbG1hY2hpbmUKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IEltcG9ydCBWaXJ0dWFsIE1hY2hp\
bmUKICBpbWFnZVVybDogaHR0cHM6Ly9jZG4ucGJyZC5jby9pbWFnZXMvSDVHdXRkNy5wbmcKcGxh\
bnM6CiAgLSBuYW1lOiB2bXdhcmUKICAgIGRlc2NyaXB0aW9uOiBJbXBvcnQgYSB2aXJ0dWFsIG1h\
Y2hpbmUgZnJvbSBWTXdhcmUgdkNlbnRlcgogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6CiAg\
ICAgIGRpc3BsYXlOYW1lOiBJbXBvcnQgZnJvbSBWTXdhcmUKICAgIHBhcmFtZXRlcnM6CiAgICAg\
IC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBVc2VybmFtZQogICAgICAgIG5hbWU6IGFkbWluX3Vz\
ZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRp\
dGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQKICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29y\
ZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlz\
cGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIHRpdGxlOiBWTXdhcmUgVVJMIHRvIEVYU2kKICAg\
ICAgICBuYW1lOiB1cmwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAtIHRpdGxlOiBWaXJ0dWFsIE1hY2hpbmUgTmFtZQogICAgICAgIG5hbWU6IHZtX25h\
bWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRp\
dGxlOiBWTXdhcmUgQWRtaW4gVXNlcm5hbWUKICAgICAgICBuYW1lOiB1c2VybmFtZQogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBl\
OiB1c2VybmFtZQogICAgICAtIHRpdGxlOiBWTXdhcmUgQWRtaW4gUGFzc3dvcmQKICAgICAgICBu\
YW1lOiBwYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogIC0gbmFtZTogdXJsCiAgICBkZXNjcmlw\
dGlvbjogQ3JlYXRlIGEgdmlydHVhbCBtYWNoaW5lIGZyb20gYSBkb3dubG9hZGVkIGRpc2sgaW1h\
Z2UKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogSW1wb3J0\
IGZyb20gVVJMCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4g\
VXNlcgogICAgICAgIG5hbWU6IGFkbWluX3VzZXIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBPcGVuU2hpZnQgQWRtaW4gUGFzc3dvcmQK\
ICAgICAgICBuYW1lOiBhZG1pbl9wYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAtIHRp\
dGxlOiBEaXNrIEltYWdlIFVSTAogICAgICAgIG5hbWU6IGRpc2tfaW1hZ2VfdXJsCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogVmlydHVh\
bCBNYWNoaW5lIFR5cGUKICAgICAgICBuYW1lOiB2bV90eXBlCiAgICAgICAgdHlwZTogZW51bQog\
ICAgICAgIGVudW06IFsnZGVmYXVsdCddCiAgICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgICBk\
ZWZhdWx0OiBkZWZhdWx0CiAgICAgICAgZGlzcGxheV90eXBlOiBzZWxlY3QKICAgICAgLSB0aXRs\
ZTogVmlydHVhbCBNYWNoaW5lIE5hbWUKICAgICAgICBuYW1lOiB2bV9uYW1lCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSB0aXRsZTogTnVtYmVyIG9m\
IENQVXMKICAgICAgICBuYW1lOiBucl9jcHVzCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ICB0eXBlOiBpbnQKICAgICAgICBkZWZhdWx0OiAxCiAgICAgIC0gdGl0bGU6IE1lbW9yeSAoaW4g\
TWVnYWJ5dGVzKQogICAgICAgIG5hbWU6IG1lbQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
ICAgdHlwZTogaW50CiAgICAgICAgZGVmYXVsdDogMTAyNAo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
RUN yum -y install libvirt-client curl qemu-img wget && yum clean all
RUN wget https://github.com/kubevirt/v2v-job/releases/download/v0.3.0/run.sh && chmod +x run.sh
USER apb
