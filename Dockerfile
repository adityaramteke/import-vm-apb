FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGltcG9ydC12bS1hcGIKZGVzY3JpcHRpb246IEltcG9ydCBWaXJ0\
dWFsIE1hY2hpbmUKYmluZGFibGU6IEZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBk\
aXNwbGF5TmFtZTogSW1wb3J0IFZpcnR1YWwgTWFjaGluZQogIGltYWdlVXJsOiBodHRwczovL2Nk\
bi5wYnJkLmNvL2ltYWdlcy9INUd1dGQ3LnBuZwpwbGFuczoKICAtIG5hbWU6IHZtd2FyZQogICAg\
ZGVzY3JpcHRpb246IEltcG9ydCBhIHZpcnR1YWwgbWFjaGluZSBmcm9tIFZNd2FyZSB2Q2VudGVy\
CiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IEltcG9ydCBm\
cm9tIFZNd2FyZQogICAgcGFyYW1ldGVyczoKICAgICAgLSB0aXRsZTogT3BlblNoaWZ0IEFkbWlu\
IFVzZXJuYW1lCiAgICAgICAgbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBQYXNz\
d29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAg\
IC0gdGl0bGU6IFZNd2FyZSBVUkwgdG8gRVhTaQogICAgICAgIG5hbWU6IHVybAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFZpcnR1YWwg\
TWFjaGluZSBOYW1lCiAgICAgICAgbmFtZTogdm1fbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gdGl0bGU6IFZNd2FyZSBBZG1pbiBVc2VybmFt\
ZQogICAgICAgIG5hbWU6IHVzZXJuYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHVzZXJuYW1lCiAgICAgIC0gdGl0bGU6\
IFZNd2FyZSBBZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IHBhc3N3b3JkCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkaXNwbGF5X3R5cGU6IHBh\
c3N3b3JkCiAgLSBuYW1lOiB1cmwKICAgIGRlc2NyaXB0aW9uOiBDcmVhdGUgYSB2aXJ0dWFsIG1h\
Y2hpbmUgZnJvbSBhIGRvd25sb2FkZWQgZGlzayBpbWFnZQogICAgZnJlZTogVHJ1ZQogICAgbWV0\
YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBJbXBvcnQgZnJvbSBVUkwKICAgIHBhcmFtZXRlcnM6\
CiAgICAgIC0gdGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAgICAgICAgbmFtZTogYWRtaW5f\
dXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0g\
dGl0bGU6IE9wZW5TaGlmdCBBZG1pbiBQYXNzd29yZAogICAgICAgIG5hbWU6IGFkbWluX3Bhc3N3\
b3JkCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBk\
aXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIC0gdGl0bGU6IERpc2sgSW1hZ2UgVVJMCiAgICAg\
ICAgbmFtZTogZGlza19pbWFnZV91cmwKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAtIHRpdGxlOiBWaXJ0dWFsIE1hY2hpbmUgVHlwZQogICAgICAgIG5h\
bWU6IHZtX3R5cGUKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydkZWZhdWx0J10K\
ICAgICAgICByZXF1aXJlZDogVHJ1ZQogICAgICAgIGRlZmF1bHQ6IGRlZmF1bHQKICAgICAgICBk\
aXNwbGF5X3R5cGU6IHNlbGVjdAogICAgICAtIHRpdGxlOiBWaXJ0dWFsIE1hY2hpbmUgTmFtZQog\
ICAgICAgIG5hbWU6IHZtX25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAtIHRpdGxlOiBOdW1iZXIgb2YgQ1BVcwogICAgICAgIG5hbWU6IG5yX2Nw\
dXMKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIHR5cGU6IGludAogICAgICAgIGRlZmF1\
bHQ6IDEKICAgICAgLSB0aXRsZTogTWVtb3J5IChpbiBNZWdhYnl0ZXMpCiAgICAgICAgbmFtZTog\
bWVtCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICB0eXBlOiBpbnQKICAgICAgICBkZWZh\
dWx0OiAxMDI0Cg=="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
RUN yum -y install libvirt-client curl qemu-img wget && yum clean all
RUN wget https://github.com/kubevirt/v2v-job/releases/download/v0.3.0/run.sh && chmod +x run.sh
USER apb
